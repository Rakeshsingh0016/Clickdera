<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gemini Chat — Demo</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#7c5cff;--user:#0ea5a5}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071029 0%, #081224 100%);color:#e6eef6;display:flex;align-items:center;justify-content:center;height:100vh}
  .app{width:100%;max-width:820px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
  header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
  header h1{margin:0;font-size:18px}
  .controls{display:flex;gap:8px;margin-bottom:12px}
  input[type="text"], select{background:#081226;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px;border-radius:8px}
  #baseUrl{flex:1}
  .chat{height:420px;overflow:auto;border-radius:10px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.03)}
  .msg{display:flex;gap:10px;margin-bottom:10px;align-items:flex-start}
  .avatar{width:36px;height:36px;border-radius:10px;background:#0b1220;display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:700}
  .bubble{max-width:82%;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);color:#dbe9ff;line-height:1.35}
  .bubble.user{background:linear-gradient(90deg,var(--user),#0b8585);color:#021014;border-radius:12px 12px 2px 12px}
  .meta{font-size:12px;color:var(--muted);margin-bottom:6px}
  .composer{display:flex;gap:8px;margin-top:12px}
  textarea{flex:1;min-height:60px;max-height:160px;padding:10px;border-radius:10px;background:#061226;border:1px solid rgba(255,255,255,0.02);color:#dfefff}
  button{background:var(--accent);border:none;color:white;padding:10px 14px;border-radius:10px;cursor:pointer}
  .small{font-size:13px;color:var(--muted);margin-top:8px}
</style>
</head>
<body>
  <div class="app">
    <header>
      <div style="width:46px;height:46;border-radius:10px;background:#071029;display:flex;align-items:center;justify-content:center">
        <strong style="color:var(--accent)">G</strong>
      </div>
      <div>
        <h1>Gemini Chat — Demo</h1>
        <div class="small">Paste your backend URL below (example already filled)</div>
      </div>
    </header>

    <div class="controls">
      <input id="baseUrl" type="text" value="https://api-gemini-js-y6al.vercel.app/api/gemini" />
      <select id="mode">
        <option value="simple">Simple generate</option>
        <option value="chat">Chat-style (messages)</option>
      </select>
      <button id="clear">Clear</button>
    </div>

    <div id="chat" class="chat" role="log" aria-live="polite"></div>

    <div class="composer">
      <textarea id="prompt" placeholder="Type your message..."></textarea>
      <div style="display:flex;flex-direction:column;gap:8px">
        <button id="send">Send</button>
        <button id="test">Quick test</button>
      </div>
    </div>

    <div class="small">Note: If you see CORS or network errors, add CORS allow on backend or test with curl.</div>
  </div>

<script>
const chatEl = document.getElementById('chat');
const baseUrlEl = document.getElementById('baseUrl');
const promptEl = document.getElementById('prompt');
const modeEl = document.getElementById('mode');

function addMessage(who, text){
  const wrap = document.createElement('div'); wrap.className = 'msg';
  const av = document.createElement('div'); av.className='avatar'; av.textContent = who === 'user' ? 'U' : 'G';
  const b = document.createElement('div'); b.className = 'bubble ' + (who==='user' ? 'user' : 'bot');
  const meta = document.createElement('div'); meta.className='meta'; meta.textContent = who==='user' ? 'You' : 'Gemini';
  b.appendChild(meta);
  const p = document.createElement('div'); p.innerHTML = escapeHtml(text).replace(/\\n/g,'<br>');
  b.appendChild(p);
  wrap.appendChild(av); wrap.appendChild(b);
  chatEl.appendChild(wrap);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function escapeHtml(s){ return s.replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

document.getElementById('clear').onclick = ()=>{ chatEl.innerHTML=''; };

document.getElementById('test').onclick = async ()=>{
  promptEl.value = "Write a short friendly one-line introduction about yourself.";
  document.getElementById('send').click();
}

document.getElementById('send').onclick = async ()=>{
  const base = (baseUrlEl.value || '').trim();
  if(!base) return alert('https://api-gemini-js-y6al.vercel.app/api/gemini');
  const prompt = (promptEl.value || '').trim();
  if(!prompt) return alert('Type a message first.');

  addMessage('user', prompt);
  promptEl.value = '';
  addMessage('bot', '…thinking…'); // placeholder
  // send request
  try {
    const payload = (modeEl.value === 'chat')
      ? { prompt } // you can adapt to message format your backend expects
      : { prompt };
    const res = await fetch(base, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    // Replace last 'thinking...' bubble with real text
    // remove last bot placeholder:
    const botBubbles = Array.from(chatEl.querySelectorAll('.bubble.bot'));
    const lastBot = botBubbles[botBubbles.length-1];
    if(!res.ok){
      const txt = await res.text();
      lastBot.querySelector('div:nth-child(2)').innerHTML = '<strong>Error:</strong> ' + escapeHtml(txt);
      return;
    }
    const data = await res.json();
    // Try to show relevant reply text from typical Google response structures:
    let reply = '';
    if (data?.candidates && Array.isArray(data.candidates)) {
      reply = data.candidates.map(c=> c?.content || c?.output || JSON.stringify(c)).join('\\n\\n');
    } else if (data?.outputs && Array.isArray(data.outputs)) {
      reply = data.outputs.map(o => (o?.content?.map(p => p?.text || p?.parts?.join('')) || []).join('\\n')).join('\\n\\n');
    } else {
      reply = JSON.stringify(data, null, 2);
    }
    lastBot.querySelector('div:nth-child(2)').innerHTML = escapeHtml(reply).replace(/\\n/g,'<br>');
  } catch (err) {
    const botBubbles = Array.from(chatEl.querySelectorAll('.bubble.bot'));
    const lastBot = botBubbles[botBubbles.length-1];
    lastBot.querySelector('div:nth-child(2)').innerHTML = '<strong>Network/Error:</strong> ' + escapeHtml(err.message);
  }
};
</script>
</body>
</html>
